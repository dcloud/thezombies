{% extends "base.html" %}{% load staticfiles %}{% load compress %}{% load tz %}{% load brains %}
{% block content %}
    <header>
        <h2>{{ agency.name }} <small>{{ agency.agency_type }} Agency</small></h2>
        <dl>
            <dt>Website</dt>
            <dd>{{ agency.url|urlize }}</dd>
        </dl>

    </header>
    {% regroup agency.reports.all by get_report_type_display as reports_by_type %}
    {% for report_type in reports_by_type %}
    <section>
        <h3>{{ report_type.grouper }}</h3>
        <table>
            <thead>
                <tr>
                    <th>Report created</th>
                    <th>Report updated</th>
                    <th>Final url</th>
                    <th>HTTP status</th>
                    <th>Parsable as JSON</th>
                    <th>JSON has errors</th>
                    <th>Is valid data catalog</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
            {% for report in report_type.list %}
                <tr>
                    <td>{{ report.created_at|date:"SHORT_DATETIME_FORMAT" }}</td>
                    <td>{{ report.created_at|date:"SHORT_DATETIME_FORMAT" }}</td>
                    <td>{{ report.responses.earliest.url|urlizetrunc:26 }}</td>
                    <td>{{ report.responses.earliest.status_code|httpreason:True }}</td>
                    {% if report.report_type == 'DCV' %}
                    <td><span class="label {{ report.responses.earliest.info.is_json|truthy:'success,alert,secondary' }}">{{ report.responses.earliest.info.is_json|truthy:"yes,no,unknown"|title }}</span></td>
                    <td><span class="label {{ report.responses.earliest.info.json_errors|truthy:'alert,success,secondary' }}">{{ report.responses.earliest.info.json_errors|truthy:"yes,no,unknown"|title }}</span></td>
                    <td><span class="label {{ report.responses.earliest.info.is_valid_data_catalog|truthy:'success,alert,secondary' }}">{{ report.responses.earliest.info.is_valid_data_catalog|truthy:"yes,no,unknown"|title }}</span></td>
                    {% else %}
                    <td></td>
                    <td></td>
                    <td></td>
                    {% endif %}
                    <td><a href='{{ report.get_absolute_url }}'>View full report</a></td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </section>
    {% endfor %}
{% endblock %}

{% block extrajs %}
    {{ block.super }}
    {# {% compress js %} #}
    {# // <script type="text/javascript" src="/static/bower_components/socket.io-client/dist/socket.io.min.js"></script> #}
    {# // <script type="text/javascript" src="/static/js/audit.js"></script> #}
    {# {% endcompress %} #}
{% endblock %}